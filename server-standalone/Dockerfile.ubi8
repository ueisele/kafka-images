ARG KAFKA_SERVER_IMAGE

FROM ${KAFKA_SERVER_IMAGE}
LABEL maintainer="code@uweeisele.eu"

ENV \
STANDALONE_CONTROLLER_PORT=9071 \
STANDALONE_BROKER_PORT=9092 \
STANDALONE_BROKER_LISTENERS="PLAINTEXT://:{{ tpl .STANDALONE_BROKER_PORT $ }}" \
STANDALONE_BROKER_IP_VERSION="ipv4" \
STANDALONE_BROKER_ADVERTISED_LISTENERS="PLAINTEXT://[{{ ipAddress \"prefer\" (tpl .STANDALONE_BROKER_IP_VERSION $) 0 }}]:{{ tpl .STANDALONE_BROKER_PORT $ }}" \
STANDALONE_BROKER_LISTENER_SECURITY_PROTOCOL_MAP="PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL"

ENV \
STANDALONE_EXTERNAL_PORT=9093 \
STANDALONE_EXTERNAL_LISTENERS="EXTERNAL://:{{ tpl .STANDALONE_EXTERNAL_PORT $ }}" \
STANDALONE_EXTERNAL_IP_VERSION="ipv4" \
STANDALONE_EXTERNAL_ADVERTISED_HOST="[{{ ipAddress \"prefer\" (tpl .STANDALONE_EXTERNAL_IP_VERSION $) 0 }}]" \
STANDALONE_EXTERNAL_ADVERTISED_PORT="{{ tpl .STANDALONE_EXTERNAL_PORT $ }}" \
STANDALONE_EXTERNAL_ADVERTISED_LISTENERS="EXTERNAL://{{ tpl .STANDALONE_EXTERNAL_ADVERTISED_HOST $ }}:{{ tpl .STANDALONE_EXTERNAL_ADVERTISED_PORT $ }}" \
STANDALONE_EXTERNAL_LISTENER_SECURITY_PROTOCOL_MAP="EXTERNAL:PLAINTEXT"

ENV \
#### Setup ####
AUTO_GENERATE_CLUSTER_ID="true" \
AUTO_FORMAT_KAFKA_STORAGE_DIR="true" \
#### Server Basics ####
KAFKA_PROCESS_ROLES="controller,broker" \
KAFKA_NODE_ID=1 \
KAFKA_CONTROLLER_QUORUM_VOTERS="1@localhost:{{ tpl .STANDALONE_CONTROLLER_PORT $ }}" \
#### Socket Server Settings ####
KAFKA_LISTENERS="CONTROLLER://:{{ tpl .STANDALONE_CONTROLLER_PORT $ }},{{ tpl .STANDALONE_BROKER_LISTENERS $ }},{{ tpl .STANDALONE_EXTERNAL_LISTENERS $ }}" \
KAFKA_ADVERTISED_LISTENERS="{{ tpl .STANDALONE_BROKER_ADVERTISED_LISTENERS $ }},{{ tpl .STANDALONE_EXTERNAL_ADVERTISED_LISTENERS $ }}" \
KAFKA_CONTROLLER_LISTENER_NAMES="CONTROLLER" \
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP="CONTROLLER:PLAINTEXT,{{ tpl .STANDALONE_BROKER_LISTENER_SECURITY_PROTOCOL_MAP $ }},{{ tpl .STANDALONE_EXTERNAL_LISTENER_SECURITY_PROTOCOL_MAP $ }}" \
#### Internal Topic Settings ####
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 \
KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS=1 \
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1 \
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1 \
KAFKA_TRANSACTION_STATE_LOG_NUM_PARTITIONS=1 \
#### Optimzations for Testing ####
KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
